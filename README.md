
# Running a Scan Node ( Polygon ) Phase 1

For information about running a node, see the [Scan Node Quickstart Documentation](https://docs.forta.network/en/latest/scanner-quickstart/)

## Dependencies

1. [Install Docker](https://docs.docker.com/get-docker/) version 20.10+ and start Docker service
2. I used ubuntu 20.04
3. Cpu : 4 Core + 16G ram + 160G SSD NVME

### Install and Configure Docker

Add a file called daemon.json to your /etc/docker directory with the following contents:

```
{
   "default-address-pools": [
        {
            "base":"172.17.0.0/12",
            "size":16
        },
        {
            "base":"192.168.0.0/16",
            "size":20
        },
        {
            "base":"10.99.0.0/16",
            "size":24
        }
    ]
}
```

Restart docker with :
```
systemctl restart docker
```
## Install Forta

### Install via APT

```
$ sudo curl https://dist.forta.network/pgp.public -o /usr/share/keyrings/forta-keyring.asc -s
$ echo 'deb [signed-by=/usr/share/keyrings/forta-keyring.asc] https://dist.forta.network/repositories/apt stable main' | sudo tee -a /etc/apt/sources.list.d/forta.list
$ sudo apt-get update
$ sudo apt-get install forta
```
###  Install Manually

```
$ sudo curl https://dist.forta.network/artifacts/forta -o /usr/local/bin/forta
$ sudo chmod 755 /usr/local/bin/forta
```

## Initial Setup
### Initialize Forta Directory
Initialization creates a private key that will sign the alerts from your scan node. You must set the $FORTA_PASSPHRASE environment variable or provide the --passphrase flag to the init command.
Initialize Forta using the forta init command :

```
$ forta init --passphrase <your_passphrase>
```
This generates a config directory, a private key, and output your address
Look like: 
```
Scanner address: 0xAAA8C491232cB65a65FBf7F36b71220B3E695AAA

Successfully initialized at /yourname/.forta
```
## Configure systemd
To override systemd service environment, you can set the variables in /etc/systemd/system/forta.service.d/env.conf like:
```
[Service]
Environment="FORTA_DIR=<your_forta_config_dir>"
Environment="FORTA_PASSPHRASE=<your_forta_passphrase>"
```

## Configure config.yml
Go to https://dashboard.alchemyapi.io/ 
Creat app Polygon mainnet and get your Http URL 

```
# Auto generated by 'forta init' - safe to modify
# The chainId is the chainId of the network that is analyzed (1=mainnet)
chainId: 137

# The scan settings are used to retrieve the transactions that are analyzed
scan:
  jsonRpc:
    url: your URL on Alchemy

# The trace endpoint must support trace_block (such as alchemy)
trace:
  enabled: false

# The registry settings are used to discover and load agents
# registry:
#  jsonRpc:
#    url: https://polygon-rpc.com/
#  ipfs:
#    gatewayUrl: https://ipfs.forta.network
#    username: <set if needed>
#    password: <set if needed>

# The jsonRpcProxy settings are used make query requests (defaults to scan url)
# jsonRpcProxy:
#   jsonRpc:
#     url: <enter if different from scan value>

# The publish settings drive how alerts are sent
# publish:
#  ipfs:
#    apiUrl: https://ipfs.forta.network
#    username: <set if needed>
#    password: <set if needed>

# The log settings drive the log output of the scan node
# log:
#  level: info
#  maxLogSize: 50m
#  maxLogFiles: 10
```

## Register Scan Node
You need to fund your scan node address with some Polygon (Mainnet) MATIC to be able to send this transaction. You can find out your scan node address with forta account address. ( Just 0.1 Matic)
```
$ forta register --owner-address your metamask address --passphrase your passphrase
```
## Run Scan Node
### Start Forta via systemd
Create the service file:
```
sudo tee /etc/systemd/system/fortad.service > /dev/null <<EOF
[Unit]
Description=Forta Node
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/root/
ExecStart=$(which forta) run --passphrase=YOUR PASSPHRASE
Restart=on-failure
RestartSec=3
LimitNOFILE=10000

[Install]
WantedBy=multi-user.target
EOF
```
Start Forta :
```
systemctl daemon-reload
systemctl enable fortad
systemctl restart fortad
```
Check Logs :
```
journalctl -n 100 -f -u fortad -o cat
```

### Start Forta manually
```
$ forta run --passphrase <your_passphrase>
```
you can check your node :
```
$ forta status
$ docker ps -a
$ dockker logs -f docker ID
```
## Note
You can scan another chain, just change Chain ID and RPC
Welocome to Forta
more info :
```
https://docs.forta.network/en/latest/scanner-quickstart/#scan-node-requirements
```

























